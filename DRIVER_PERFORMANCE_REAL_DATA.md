# Driver Performance - Real Data Implementation โ

## ๐ ุงูุชุญุฏูุซ ุงููููุฌุฒ

ุชู ุงุณุชุจุฏุงู ุงูุจูุงูุงุช ุงูููููุฉ (Fake Data) ูู ูุณู Driver Performance ุจุจูุงูุงุช ุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## ๐ ูุง ุชู ุชุบููุฑู

### ูุจู ุงูุชุญุฏูุซ โ
```typescript
driverMetrics: [
  {
    driverId: '1',
    driverName: 'John Smith',
    completedJobs: 45,
    avgRating: 4.8,
    earnings: 1250,
    onTimeRate: 95,
  },
  // ... ุจูุงูุงุช ููููุฉ ุฃุฎุฑู
]
```

### ุจุนุฏ ุงูุชุญุฏูุซ โ
```typescript
// ุงุณุชุนูุงู ุญูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
const realDrivers = await prisma.driver.findMany({
  where: {
    status: { in: ['active', 'available', 'on_job'] },
  },
  select: {
    id: true,
    user: { select: { name: true } },
    Assignment: { /* completed jobs */ },
    ratings: { /* driver ratings */ },
    earnings: { /* driver earnings */ },
  },
});

// ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ
const driverMetrics = realDrivers.map(driver => ({
  driverId: driver.id,
  driverName: driver.user?.name || 'Unknown Driver',
  completedJobs: driver.Assignment.length,
  avgRating: /* ุญุณุงุจ ุงููุชูุณุท ุงูุญูููู */,
  earnings: /* ุญุณุงุจ ุงูุฃุฑุจุงุญ ุงููุนููุฉ */,
  onTimeRate: /* ุญุณุงุจ ูุนุฏู ุงูุงูุชุฒุงู ุจุงูููุงุนูุฏ */,
}));
```

---

## ๐ ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ ุงูุขู

### 1. Completed Jobs (ุงููุธุงุฆู ุงููููููุฉ)
- **ุงููุตุฏุฑ**: `Assignment` table
- **ุงูุดุฑุท**: `status = 'completed'`
- **ุงููุชุฑุฉ**: ุญุณุจ ูุทุงู ุงูุชุงุฑูุฎ ุงููุญุฏุฏ (7d, 30d)

### 2. Average Rating (ูุชูุณุท ุงูุชูููู)
- **ุงููุตุฏุฑ**: `DriverRating` table
- **ุงูุญุณุงุจ**: ูุฌููุน ุงูุชููููุงุช รท ุนุฏุฏ ุงูุชููููุงุช
- **ุงูุชูุณูู**: ุฑูู ุนุดุฑู ุจุฎุงูุฉ ูุงุญุฏุฉ (ูุซุงู: 4.7)

### 3. Total Earnings (ุฅุฌูุงูู ุงูุฃุฑุจุงุญ)
- **ุงููุตุฏุฑ**: `DriverEarnings` table
- **ุงูุญููู ุงูููุณุชุฎุฏูุฉ**:
  - `netAmountPence` - ุงูุฏุฎู ุงูุตุงูู
  - `tipAmountPence` - ุงูุจูุดูุด
- **ุงูุชุญููู**: ูู Pence ุฅูู GBP (รท 100)
- **ุงูุชูุณูู**: ุฑูู ุตุญูุญ ุจุงูุฌููู ุงูุฅุณุชุฑูููู

### 4. On-Time Rate (ูุนุฏู ุงูุงูุชุฒุงู ุจุงูููุงุนูุฏ)
- **ุงูุญุณุงุจ**: 
  - ููุงุฑูุฉ `estimatedPickupTime` ูุน `actualPickupTime`
  - ููุนุชุจุฑ "ูู ุงูููุช ุงููุญุฏุฏ" ุฅุฐุง ูุงู ุงููุฑู โค 15 ุฏูููุฉ
  - ุงููุณุจุฉ ุงููุฆููุฉ = (ุนุฏุฏ ุงูููุงุนูุฏ ุงูููุชุฒู ุจูุง รท ุฅุฌูุงูู ุงููุธุงุฆู) ร 100

---

## ๐ฏ ุงูููุงุชุฑ ุงูููุทุจูุฉ

### ุดุฑูุท ุงูุณุงุฆููู ุงููุนุฑูุถูู:
```typescript
WHERE status IN ('active', 'available', 'on_job')
AND Assignment.status = 'completed'
AND Assignment.createdAt >= dateRange
```

### ููุชุฑ ุงูุนุฑุถ ุงูููุงุฆู:
- ูุชู ุนุฑุถ ุงูุณุงุฆููู ุงูุฐูู ูุฏููู ุนูู ุงูุฃูู ูุธููุฉ ูุงุญุฏุฉ ูููุชููุฉ
- ุงูุชุฑุชูุจ: ุญุณุจ ุนุฏุฏ ุงููุธุงุฆู ุงููููุชููุฉ (ูู ุงูุฃุนูู ููุฃูู)

---

## ๐ ุนุฑุถ ุงูุจูุงูุงุช ูู Admin Dashboard

### ุงููุณุงุฑ:
```
/admin/analytics โ Driver Performance Tab
```

### ุงูุฌุฏูู ูุนุฑุถ:

| Column | Description | Source |
|--------|-------------|--------|
| Driver | ุงุณู ุงูุณุงุฆู | `User.name` |
| Completed Jobs | ุนุฏุฏ ุงููุธุงุฆู ุงููููุชููุฉ | Count of `Assignment` |
| Rating | ูุชูุณุท ุงูุชูููู | Average of `DriverRating.rating` |
| Earnings | ุฅุฌูุงูู ุงูุฃุฑุจุงุญ | Sum of `DriverEarnings` |
| On-Time Rate | ูุณุจุฉ ุงูุงูุชุฒุงู ุจุงูููุงุนูุฏ | Calculated % |

---

## ๐ ุฃูุซูุฉ ุนูู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ

### ูุซุงู 1: ุณุงุฆู ูุดุท
```json
{
  "driverId": "cm123abc",
  "driverName": "Ahmed Hassan",
  "completedJobs": 28,
  "avgRating": 4.7,
  "earnings": 847,
  "onTimeRate": 93
}
```

### ูุซุงู 2: ุณุงุฆู ุฌุฏูุฏ
```json
{
  "driverId": "cm456def",
  "driverName": "Sarah Mohammed",
  "completedJobs": 5,
  "avgRating": 5.0,
  "earnings": 150,
  "onTimeRate": 100
}
```

### ูุซุงู 3: ูุง ููุฌุฏ ุณุงุฆููู ูุดุทูู
```json
{
  "driverMetrics": []
}
```
*ุณูุนุฑุถ ุงูุฌุฏูู: "No drivers found" ุฃู ุฌุฏูู ูุงุฑุบ*

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงูุชุญ Analytics Dashboard
```
http://localhost:3000/admin/analytics
```

### 2. ุงุฐูุจ ุฅูู "Driver Performance" Tab

### 3. ุชุญูู ูู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ
- ูุฌุจ ุฃู ุชุฑู ุฃุณูุงุก ุงูุณุงุฆููู ุงูุญูููููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุฃุฑูุงู ูุฌุจ ุฃู ุชููู ูุงูุนูุฉ (ููุณุช 45, 38, 42 ุงูููููุฉ)
- ุงูุชููููุงุช ูุฌุจ ุฃู ุชููู ูุทุงุจูุฉ ููุชููููุงุช ุงููุนููุฉ

### 4. ุฌุฑุจ ุชุบููุฑ ูุทุงู ุงูุชุงุฑูุฎ
- 7 ุฃูุงู: ุณุชุฑู ุจูุงูุงุช ุขุฎุฑ ุฃุณุจูุน ููุท
- 30 ููู: ุณุชุฑู ุจูุงูุงุช ุขุฎุฑ ุดูุฑ
- 24 ุณุงุนุฉ: ุณุชุฑู ุจูุงูุงุช ุงูููู ููุท

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุณุงุฆููู ุงูููุณุชุจุนุฏูู:
- ุงูุณุงุฆููู ุจุญุงูุฉ `inactive` ุฃู `suspended`
- ุงูุณุงุฆููู ุจุฏูู ุฃู ูุธุงุฆู ูููุชููุฉ ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ

### 2. ูุนุงุฏูุฉ On-Time Rate:
```typescript
const isOnTime = (actualTime - estimatedTime) <= 15 minutes
const onTimeRate = (onTimeJobs / totalJobs) * 100
```

### 3. ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ุงูููููุฏุฉ:
- ุฅุฐุง ูู ููู ููุณุงุฆู ุงุณู: ููุนุฑุถ "Unknown Driver"
- ุฅุฐุง ูู ููู ููุงู ุชููููุงุช: ููุนุฑุถ 0
- ุฅุฐุง ูู ููู ููุงู ุฃุฑุจุงุญ: ููุนุฑุถ 0

---

## ๐จ ุงูุชุญุณููุงุช ุงูููุณุชูุจููุฉ (ุงุฎุชูุงุฑูุฉ)

### ูููู ุฅุถุงูุฉ:
1. โ ููุชุฑ ุญุณุจ ููุน ุงููุฑูุจุฉ
2. โ ููุชุฑ ุญุณุจ ุงูููุทูุฉ ุงูุฌุบุฑุงููุฉ
3. โ ุนุฑุถ ุชูุงุตูู ูู ุณุงุฆู ุนูุฏ ุงูููุฑ
4. โ ุชุตุฏูุฑ ุจูุงูุงุช ุงูุณุงุฆููู ุฅูู Excel/CSV
5. โ ุฑุณูู ุจูุงููุฉ ูุฃุฏุงุก ุงูุณุงุฆููู ุนุจุฑ ุงูุฒูู

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ุงูุขู ูู `/admin/analytics`:
- โ ุจูุงูุงุช ุงูุณุงุฆููู ุญููููุฉ 100%
- โ ุงูุฃุฑูุงู ููุญุฏุซุฉ ุญุณุจ ูุทุงู ุงูุชุงุฑูุฎ
- โ ุงูุญุณุงุจุงุช ุฏูููุฉ (ุงูุชููููุงุชุ ุงูุฃุฑุจุงุญุ ูุนุฏู ุงูุงูุชุฒุงู)
- โ ูุง ุชูุฌุฏ ุจูุงูุงุช ููููุฉ

### ูุจู:
```
John Smith, Sarah Johnson, Mike Wilson... (ุฃุณูุงุก ููููุฉ)
```

### ุงูุขู:
```
ุฃุณูุงุก ุงูุณุงุฆููู ุงูุญูููููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---

**ุชู ุจูุฌุงุญ! โ**  
**ุงูุชุงุฑูุฎ**: 6 ุฃูุชูุจุฑ 2025  
**ุงูููู ุงูููุนุฏู**: `apps/web/src/app/api/admin/analytics/route.ts`
