# نظام التسعير الديناميكي المحسن - Speedy Van

## نظرة عامة

تم تطوير نظام تسعير ديناميكي متقدم يتكيف مع العوامل المختلفة التي تؤثر على تكلفة خدمات النقل. هذا النظام يضمن تسعيراً عادلاً وشفافاً يعكس التكلفة الحقيقية للخدمة.

## العوامل المؤثرة على التسعير

### 1. المسافة بين العناوين

#### **النظام الأساسي:**

- **النطاقات المتدرجة:**
  - 0-10 كم: 160 بنس/كم
  - 10-30 كم: 120 بنس/كم
  - 30-80 كم: 100 بنس/كم
  - أكثر من 80 كم: 85 بنس/كم

#### **رسوم الرحلة العائدة:**

- **مع حمولة عائدة:** 50 بنس/كم
- **بدون حمولة عائدة:** 100 بنس/كم

### 2. الطوابق والوصول ونوع المنزل

#### **رسوم الطوابق:**

- **الطابق الأرضي:** بدون تكلفة إضافية
- **كل طابق إضافي بدون مصعد:** 400 بنس لكل طابق لكل عضو في الطاقم
- **الحد الأقصى:** 6 طوابق

#### **عامل المصعد:**

- **مصعد متاح:** تخفيض 50-70% من رسوم الطوابق
- **مصعد غير متاح:** رسوم كاملة للطوابق

#### **صعوبة الوقوف:**

- **سهل:** بدون رسوم إضافية
- **متوسط:** 500 بنس
- **صعب:** 1000 بنس

#### **وصول الشارع:**

- **شوارع ضيقة:** 800 بنس إضافية

### 3. عدد الأغراض

#### **التسعير المحسن للأغراض:**

- **رسوم أساسية:** 50 بنس لكل غرض
- **حسب الحجم:** 200 بنس لكل م³
- **حسب الوزن:** 100 بنس لكل كجم
- **عامل الهشاشة:**
  - منخفضة: مضاعف 1.0
  - متوسطة: مضاعف 1.2
  - عالية: مضاعف 1.5

#### **التعامل الخاص:**

- **أغراض تحتاج تعامل خاص:** 500 بنس لكل غرض

### 4. حجم الأغراض

#### **التسعير حسب الحجم:**

- **الحساب التلقائي:** بعد اختيار صور الأغراض
- **سعر الحجم:** 200 بنس لكل م³
- **استخدام الشاحنة:** حساب ديناميكي لاستخدام مساحة الشاحنة

### 5. التاريخ والوقت والطقس

#### **أوقات الذروة:**

- **عطلات نهاية الأسبوع:** مضاعف 1.1
- **العطل الرسمية:** مضاعف 1.2
- **الليل:** مضاعف 1.25

#### **التسعير حسب الطقس (تلقائي):**

- **درجة الحرارة:**
  - أقل من 0°م: زيادة 10%
  - أكثر من 30°م: زيادة 15%
- **الأمطار:**
  - أمطار خفيفة (5-10 مم/ساعة): زيادة 10%
  - أمطار غزيرة (>10 مم/ساعة): زيادة 20%
- **سرعة الرياح:**
  - رياح متوسطة (20-30 كم/ساعة): زيادة 8%
  - رياح عالية (>30 كم/ساعة): زيادة 15%
- **الرؤية:**
  - رؤية منخفضة (1-5 كم): زيادة 10%
  - رؤية ضعيفة (<1 كم): زيادة 25%

### 6. عدد العمال المطلوبين

#### **الطاقم الأساسي:**

- **شاحنة صغيرة:** طاقم واحد (مدرج في السعر الأساسي)
- **شاحنة كبيرة:** طاقم اثنين (مدرج في السعر الأساسي)

#### **عمال إضافيون:**

- **عامل إضافي:** 25 جنيه/ساعة
- **الحساب التلقائي:** للأغراض الثقيلة/الكبيرة

## الصيغة الرياضية

```
السعر النهائي = (
  السعر الأساسي +
  رسوم المسافة +
  رسوم الوصول +
  رسوم صعوبة الوقوف +
  رسوم وصول الشارع +
  رسوم الأغراض +
  رسوم التعامل الخاص +
  رسوم الحجم +
  رسوم التجميع/الفك +
  رسوم المواد +
  رسوم الرحلة العائدة +
  مضاعف الطقس +
  مضاعف الوقت/اليوم
) × ضريبة القيمة المضافة
```

## الميزات الجديدة

### 1. **التكامل مع API الطقس**

- جلب بيانات الطقس في الوقت الفعلي
- حساب تلقائي للتعديلات حسب الطقس
- تحديث الأسعار تلقائياً عند اختيار التاريخ

### 2. **تحليل الأغراض المتقدم**

- تصنيف الأغراض حسب النوع والحجم والوزن
- حساب الهشاشة والتعامل الخاص
- تقدير دقيق للحجم المطلوب

### 3. **تقييم الوصول المحسن**

- تقييم صعوبة الوقوف
- تحليل وصول الشارع
- حساب دقيق لرسوم الطوابق

### 4. **رسوم الرحلة العائدة الذكية**

- حساب تلقائي لاحتمالية الحمولة العائدة
- تسعير مختلف مع/بدون حمولة عائدة
- تحسين استخدام الشاحنات

## التنفيذ التقني

### الملفات المحدثة:

- `apps/web/src/lib/pricing.ts` - نظام التسعير المحسن
- `apps/web/src/app/api/booking-luxury/[id]/route.ts` - API الحجوزات (مُحدث)

### الدوال الجديدة:

- `calculateWeatherMultiplier()` - حساب مضاعف الطقس
- `calculateItemPricing()` - تسعير الأغراض المحسن
- `calculateAccessPricing()` - تسعير الوصول المحسن
- `calculateReturnTripSurcharge()` - رسوم الرحلة العائدة

### التكامل مع APIs الخارجية:

- **Weather API:** لجلب بيانات الطقس
- **Mapbox Directions:** لحساب المسافات والمسارات
- **Image Recognition:** لتحليل صور الأغراض

## الفوائد

### 1. **دقة أكبر في التسعير**

- مراعاة جميع العوامل المؤثرة
- حساب ديناميكي للأسعار
- شفافية في تفصيل التكاليف

### 2. **تحسين الربحية**

- تسعير عادل يعكس التكلفة الحقيقية
- تقليل الخسائر من التسعير المنخفض
- زيادة الإيرادات من الخدمات الإضافية

### 3. **رضا العملاء**

- شفافية في التسعير
- عدم وجود مفاجآت في الأسعار
- تسعير عادل ومنطقي

### 4. **كفاءة التشغيل**

- تحسين استخدام الشاحنات
- تقليل الرحلات الفارغة
- تحسين جدولة المواعيد

## الخطوات التالية

### 1. **التكامل مع APIs**

- إعداد Weather API
- تحسين Image Recognition
- ربط Mapbox Directions

### 2. **اختبار النظام**

- اختبار الحالات المختلفة
- التحقق من دقة الحسابات
- اختبار الأداء

### 3. **التدريب والتوثيق**

- تدريب فريق العمليات
- تحديث دليل المستخدم
- إنشاء فيديوهات تعليمية

### 4. **المراقبة والتحسين**

- مراقبة أداء النظام
- جمع ملاحظات العملاء
- تحسين مستمر للخوارزميات
